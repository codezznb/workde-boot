{"hidden":false,"children":[{"configs":{"itemId":"sys.home","cssLinks":"[\"styles/home.css\"]","serviceMethod":"portalService.initHome"},"expanded":true,"children":[{"configs":{"layout":"border","itemId":"viewport1"},"expanded":true,"children":[{"configs":{"border":"false","layout":"hbox","itemId":"topBar","cls":"x-unselectable pt_topbar","region":"north","height":"38"},"expanded":true,"children":[{"configs":{"itemId":"appTitle","html":"<span itemId=\"appMenuBtn\" class=\"pt_app_title\">后台管理平台<\/span>"},"expanded":false,"children":[],"type":"comp"},{"configs":{"layout":"fit","border":"false","itemId":"navBarHolder","flex":"1"},"expanded":true,"children":[{"configs":{"itemId":"navIconBar","enableOverflow":"true"},"expanded":false,"children":[],"type":"toolbar"}],"type":"container"},{"configs":{"itemId":"appButtons","padding":"11 5 0 5","html":"<span itemId=\"userBtn\" style=\"cursor:pointer;\">管理员<\/span> | \n<span itemId=\"mainMenuBtn\" style=\"cursor:pointer;\">操作&nbsp;&nbsp;<span class=\"wb_glyph\" itemId=\"menuBtn\">&#xf107;<\/span><\/span>"},"expanded":false,"children":[],"type":"comp"}],"type":"container"},{"configs":{"border":"false","layout":"card","itemId":"moduleView","split":"true","collapsed":"false","width":"240","header":"false","cls":"pt_cardpanel","region":"west","collapsible":"true"},"expanded":true,"children":[{"configs":{"border":"false","itemId":"cardComp"},"expanded":true,"children":[{"configs":{"border":"false","itemId":"cardItemsComp","cls":"pt_cardview","autoScroll":"true"},"expanded":true,"children":[],"type":"comp"}],"type":"panel","events":{"afterrender":"app.cardComp.body.unselectable();\napp.cardComp.mon(app.cardComp.body, 'click', app.monCardCompClick);"}},{"configs":{"itemId":"tree","hidden":"true"},"expanded":true,"children":[{"configs":{"itemId":"store","normalName":"treeStore","root":"${treeNodes}","fields":"['text', 'path', 'fileName', 'inframe', 'pageLink']"},"expanded":false,"children":[],"type":"treestore"}],"type":"tree","events":{"tagEvents":"{\n  itemkeydown: Wb.mimicClick\n}"}}],"type":"panel","events":{"show":"console.log('show');\napp.createCardView();"}},{"configs":{"itemId":"tab","region":"center"},"expanded":false,"children":[],"type":"tab","events":{"tabchange":"if (newCard && newCard.notLoaded) {\n  newCard.notLoaded = false;\n  Wb.open({\n    reloadCard: newCard,\n    frameOnly: false,\n    notActiveCard: false\n  });\n}"}}],"type":"viewport","events":{"afterrender":"app.doAfterRender();"}}],"type":"module","events":{"initialize":"Wb.apply(app, {\n  doAfterRender: function() {\n\tExt.suspendLayouts();\n    \n    app.portal = app.tab.add({\n      appScope: app,\n      itemId: 'homeCard',\n      xtype: 'portalpanel',\n      iconCls: 'home_icon',\n      border: false,\n      title: Str.home,\n      bodyStyle: 'background:#f3f3f3;',\n      reorderable: false\n    });\n    app.tab.setActiveTab(app.portal);\n    app.portal.add([{\n      xtype: 'portalcolumn'\n    }, {\n      xtype: 'portalcolumn'\n    }]);\n    app.populatePages();\n\tapp.loadView(app.tree.getRootNode());\n    Ext.resumeLayouts(true);\n  },\n  \n  /**\n   * 加载保存的页面。\n   */\n  populatePages: function() {\n    var tab = app.tab;\n    tab.mon(tab.tabBar.el, 'dblclick', function(e, target) {\n      var card = tab.getActiveTab(),\n        url = card.bindFile;\n\n      if (card.tab.el.isAncestor(target) && !card.hasParams && url) {\n        if (Ext.String.endsWith(url, '.xwl'))\n          url = 'builder?xwl=' + url.slice(0, -4);\n        window.open(url);\n      }\n    }, tab);\n  },\n  \n  /**\n   * 创建应用卡片（抽屉式）视图。\n   */\n  createCardView: function() {\n    var root = app.navIconBar.isVisible() ? app.selAppNode : app.tree.getRootNode();\n    if(app.cardBindNode == root) return;\n    else app.cardBindNode = root;\n    if(!root || !root.isLoaded()) return;\n    html = '<table itemId=\"moduleListTable\" cellpadding=\"0\" cellspacing=\"0\" class=\"pt_nav_table pt_card_margin\">';\n    root.cascadeBy(function(child) {\n      if(child == root) return;\n      nodeId = child.id.substring(1);\n      nodeStatus = app.cardStatusMap[nodeId];\n      html += '<tr class=\"';\n      if(!child.data.leaf){\n        if (nodeStatus && !nodeStatus[1])\n          html += 'pt_view_folder_exp';\n        else\n          html += 'pt_view_folder';\n      }else {\n        html += 'pt_view_item';\n      }\n      html += '\"';\n      \n//       if ((!nodeStatus || nodeStatus[0]))\n//         html += ' style=\"display:none;\"';\n      if (!child.data.leaf && (!nodeStatus || nodeStatus[1])) {\n        html += ' isCollapsed=\"true\"';\n        collapsed = true;\n      } else collapsed = false;\n      html += ' node=\"' + nodeId + '\"><td style=\"padding:0 8px 0 8px;\">';\n      icon = app.getAppIcon(child, null, false, 'pt_abs_icon');\n      if (child.data.leaf) {\n        html += icon;\n        if (child.data.iconCls) {\n          html += '<span class=\"pt_line_icon\"><\/span>';\n        }else {\n          html += '<span class=\"pt_line_icon pt_ball_icon\"><\/span>';\n        }\n      }else {\n        html += '<span class=\"wb_glyph ' + (collapsed ? 'pt_folder' : 'pt_folder_open') +\n          ' pt_folder_flag\"><\/span>' + icon;\n      }\n      html += '<span class=\"pt_item\">' + child.data.text + '<\/span><\/td><\/tr>';\n      \n    });\n    html += '<\/table>';\n    app.cardItemsComp.update(html);\n  },\n  \n  loadView: function(baseNode) {\n    app.cardBindNode = null;\n    app.cardStatusMap = {};\n    app.createCardView();\n    var item, data, items = [];\n    app.treeStore.getRootNode().eachChild(function(node){\n      data = node.data;\n      item = {\n        text: data.text,\n        leaf: data.leaf,\n        node: node\n      };\n      if(data.leaf) {\n        item.handler = app.navIconHandler;\n      }else {\n        Wb.apply(item, {\n          allowDepress: false,\n          toggleGroup: 'navIcon',\n          mouseClickPress: true,\n          listeners: {\n            toggle: app.navIconToggle\n          }\n        });\n      }\n      if (Ext.isNumeric('0x' + data.iconCls))\n        item.glyph = parseInt('0x' + data.iconCls, 16);\n      else \n        item.iconCls = data.iconCls;\n      items.push(item);\n    });\n    Ext.suspendLayouts();\n    app.navIconBar.removeAll();\n    app.navIconBar.add(items);\n    if (app.navIconBar.isVisible() && items.length) app.navIconBar.items.items[0].toggle(true);\n    Ext.resumeLayouts(true);\n\t\n  },\n  /**\n   * 监听卡片视图中应用的点击事件。\n   */\n  monCardCompClick: function(e, target) {\n    var nodeId, node, el = Ext.get(target), toPortal = e.ctrlKey;\n    el = el.up('tr');\n    if (!el)\n      return;\n    nodeId = el.getAttribute('node');\n    if (nodeId) {\n      node = app.treeStore.getNodeById(nodeId);\n      if (node.data.leaf) {\n        if (app.selItemEl)\n          app.selItemEl.removeCls('pt_item_sel');\n        el.addCls('pt_item_sel');\n        app.selItemEl = el;\n        app.openModule(node, toPortal);\n        return;\n      }\n    }\n  },\n  \n  openModule: function(record, toPortal){\n    var data = record.data,\n        pageLink = {\n        url: Wb.toUrl(data.path),\n        title: data.text,\n        iconCls: data.iconCls,\n        inframe: data.inframe\n      };\n    if (data.pageLink) {\n      Ext.apply(pageLink, Wb.decode(data.pageLink));\n    }\n    if (toPortal)\n      app.addPortlet(pageLink, 0);\n    else\n      Wb.open(pageLink);\n  },\n  \n  /**\n   * 导航按钮目录的切换事件。\n   */\n  navIconToggle: function(item, pressed) {\n    var node = item.node;\n    if(pressed) {\n      if(app.lastSelIcon) {\n        var listTable;\n        app.lastSelIcon.node.viewScrollPos = app.cardItemsComp.el.dom.scrollTop;\n        listTable = app.cardItemsComp.el.query('[itemId=moduleListTable] tr', true);\n        Wb.each(listTable, function(tr) {\n          tr = Ext.fly(tr);\n          app.cardStatusMap[tr.getAttribute('node')] = [tr.getStyle('display') == 'none', tr.getAttribute('isCollapsed') == 'true'];\n        });\n      }\n      app.lastSelIcon = item;\n      if(app.selAppNode != node) {\n        app.selAppNode = node;\n        app.createCardView();\n      }\n      if(node.viewScrollPos !== undefined) {\n        app.cardItemsComp.el.dom.scrollTop = node.viewScrollPos;\n      }\n    }\n  },\n \n  /**\n   * 获取应用模块的图标样式类。\n   */\n  getAppIcon: function(node, top, nullIcon, cls) {\n    var iconCls = node.data.iconCls;\n    if (cls)\n      cls = cls + ' ';\n    else\n      cls = '';\n    if (!node.data.leaf && !iconCls)\n      iconCls = 'f114';\n    if (Ext.isNumeric('0x' + iconCls)) {\n      return '<span class=\"pt_glyph wb_glyph ' + cls + 'wb_glyphsize\">&#x' + iconCls + ';<\/span>';\n    } else {\n      return '<img src=\"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\" style=\"margin:' +\n        ((top || 2) + (Wb.isNeptune ? -3 : 0)) + 'px 5px 0 4px;\" class=\"x-tree-icon ' + cls +\n        (nullIcon ? 'null_icon' : iconCls) + '\">';\n    }\n  }\n  \n  \n});"}}],"roles":{"default":1},"title":"主页","iconCls":"","inframe":false,"pageLink":"{path:'home', method: 'get', newWin: true}"}